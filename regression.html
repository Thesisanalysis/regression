<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Simple Linear Regression Calculator</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 700px; margin: 30px auto; padding: 20px; }
        h2 { text-align: center; color: #3498db; }
        .instructions { background: #f8f9fa; padding: 12px; border-radius: 5px; margin-bottom: 20px; }
        textarea { width: 100%; min-height: 120px; margin-bottom: 10px; font-family: monospace; padding: 8px; border-radius: 4px; border: 1px solid #ddd; }
        .primary-btn { background: #3498db; color: #fff; border: none; padding: 10px 14px; border-radius: 4px; cursor: pointer; font-size: 15px; margin-bottom: 10px; }
        .primary-btn:hover { background: #2980b9; }
        .input-row { display: flex; gap: 15px; margin-bottom: 10px; }
        .input-row label { flex: 1; }
        #errorContainer { color: #e74c3c; font-weight: bold; margin-bottom: 10px; }
        #resultsContainer { margin-top: 18px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 7px; text-align: center; }
        th { background: #3498db; color: #fff; }
        .sig { color: #e74c3c; font-weight: bold;}
    </style>
</head>
<body>
    <h2>Simple Linear Regression Calculator</h2>
    <div class="instructions">
        <ol>
            <li>Paste your data (with headers) in the box below.</li>
            <li>Select dependent and independent variable columns.</li>
            <li>Click "Run Regression" for results.</li>
        </ol>
        <p><strong>Data Format Example:</strong></p>
        <pre>
Protein[gms]	Energy in Kcal
27.61	1950.00
77.47	2144.24
56.26	2015.32
...
        </pre>
        <p>Accepts tab or comma separated values.</p>
    </div>
    <textarea id="tDataInput" rows="8" placeholder="Paste your data here"></textarea>
    <div class="input-row">
        <label>Dependent variable:
            <select id="dependentSelect"></select>
        </label>
        <label>Independent variable:
            <select id="independentSelect"></select>
        </label>
    </div>
    <button id="runBtn" class="primary-btn">Run Regression</button>
    <div id="errorContainer"></div>
    <div id="resultsContainer"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.7.0/math.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jstat@1.9.5/dist/jstat.min.js"></script>
    <script>
        let dataRows = [];
        let headers = [];

        function showError(msg) {
            document.getElementById('errorContainer').textContent = msg;
        }
        function clearError() {
            document.getElementById('errorContainer').textContent = '';
        }

        function parseData(raw) {
            const lines = raw.trim().split('\n').filter(line => line.trim() !== "");
            if (lines.length < 2) return showError("Please provide at least header and one data row.");
            let rows = lines.map(line =>
                line.includes('\t') ? line.split('\t').map(x => x.trim()) : line.split(',').map(x => x.trim())
            );
            headers = rows[0];
            dataRows = rows.slice(1).filter(row => row.length === headers.length);
            if (dataRows.length === 0) return showError("No data found after header.");
        }

        function populateDropdowns() {
            const dep = document.getElementById('dependentSelect');
            const indep = document.getElementById('independentSelect');
            dep.innerHTML = indep.innerHTML = "";
            headers.forEach((h, i) => {
                dep.innerHTML += `<option value="${i}">${h}</option>`;
                indep.innerHTML += `<option value="${i}">${h}</option>`;
            });
        }

        document.getElementById('tDataInput').addEventListener('input', function() {
            clearError();
            parseData(this.value);
            if (headers.length > 1) populateDropdowns();
        });

        document.getElementById('runBtn').addEventListener('click', function() {
            clearError();
            parseData(document.getElementById('tDataInput').value);
            const depIdx = Number(document.getElementById('dependentSelect').value);
            const indepIdx = Number(document.getElementById('independentSelect').value);
            if (depIdx === indepIdx) return showError("Select different columns for X and Y.");
            if (dataRows.length < 2) return showError("At least two rows required.");
            let x = [], y = [];
            dataRows.forEach(row => {
                let xv = parseFloat(row[indepIdx]);
                let yv = parseFloat(row[depIdx]);
                if (!isNaN(xv) && !isNaN(yv)) {
                    x.push(xv); y.push(yv);
                }
            });
            if (x.length < 2) return showError("Not enough valid numeric data.");
            simpleRegression(x, y, headers[indepIdx], headers[depIdx]);
        });

        function simpleRegression(x, y, xName, yName) {
            // Least squares
            const n = x.length;
            const xmean = math.mean(x), ymean = math.mean(y);
            let Sxy = 0, Sxx = 0;
            for (let i = 0; i < n; ++i) {
                Sxy += (x[i] - xmean) * (y[i] - ymean);
                Sxx += (x[i] - xmean) ** 2;
            }
            if (Sxx === 0) return showError("Independent variable is constant.");
            const slope = Sxy/Sxx, intercept = ymean - slope*xmean;
            // Predicted values and residuals
            let ypred = x.map(xv => intercept + slope*xv);
            let residuals = y.map((yv, i) => yv - ypred[i]);
            let SSres = residuals.reduce((acc, r) => acc + r*r, 0);
            let SStot = y.reduce((acc, yv) => acc + (yv - ymean)**2, 0);
            let Rsq = 1 - SSres/SStot;
            let SEslope = Math.sqrt(SSres/(n-2)/Sxx);
            let SEint = Math.sqrt(SSres/(n-2)*(1/n + xmean*xmean/Sxx));
            let tSlope = slope/SEslope, tInt = intercept/SEint;
            let pSlope = 2*(1-jStat.studentt.cdf(Math.abs(tSlope), n-2));
            let pInt = 2*(1-jStat.studentt.cdf(Math.abs(tInt), n-2));
            let F = (SStot-SSres)/SSres * (n-2)/1;
            let pF = 1-jStat.centralF.cdf(F, 1, n-2);
            // Show results
            let html = `<h3>Simple Regression Results</h3>
            <table>
            <tr><th>Model</th><td>${yName} = ${intercept.toFixed(4)} + ${slope.toFixed(4)} Ã— ${xName}</td></tr>
            <tr><th>R-squared</th><td>${Rsq.toFixed(4)}</td></tr>
            <tr><th>F-statistic</th><td>${F.toFixed(2)}</td></tr>
            <tr><th>Model p-value</th><td>${pF.toExponential(3)}</td></tr>
            </table>
            <h4>Coefficients</h4>
            <table>
            <tr><th>Term</th><th>Value</th><th>Std. Error</th><th>t</th><th>p</th></tr>
            <tr>
                <td>Intercept</td>
                <td>${intercept.toFixed(4)}</td>
                <td>${SEint.toFixed(4)}</td>
                <td>${tInt.toFixed(4)}</td>
                <td class="${pInt < 0.05 ? 'sig' : ''}">${pInt.toExponential(3)}</td>
            </tr>
            <tr>
                <td>${xName}</td>
                <td>${slope.toFixed(4)}</td>
                <td>${SEslope.toFixed(4)}</td>
                <td>${tSlope.toFixed(4)}</td>
                <td class="${pSlope < 0.05 ? 'sig' : ''}">${pSlope.toExponential(3)}</td>
            </tr>
            </table>
            <h4>Residuals</h4>
            <table>
            <tr><th>Observed ${yName}</th><th>Predicted</th><th>Residual</th></tr>`;
            for (let i = 0; i < n; ++i) {
                html += `<tr><td>${y[i].toFixed(2)}</td><td>${ypred[i].toFixed(2)}</td><td>${residuals[i].toFixed(2)}</td></tr>`;
            }
            html += `</table>`;
            document.getElementById('resultsContainer').innerHTML = html;
        }
    </script>
</body>
</html>
